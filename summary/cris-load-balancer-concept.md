# Network Concept

## 1. Load Balancing

### 1.1 Load Balancing 개념
- 백엔드 서버 그룹에 효율적으로 분산시키는 것
- 여러 대의 서버를 두고 서비스를 제공하는 분산 처리 시스템에서 필요한 기술
- 컴퓨터 네트워크 기술의 일종으로 둘 or 셋 이상의 중앙처리장치 혹은 저장장치와 같은 컴퓨터 자원들에 작업을 나누는 것

### 1.2 Load Balancing 종류
- L4 : Transport 계층을 사용, IP 주소와 포트 번호 부하 분산이 가능
- L7 : Application 계층을 사용, URL 또는 HTTP 헤더에서 부하 분산이 가능

### 1.3 Load Balancing 장단점
- 저렴한 비용에 다수의 서버로 증설하여 경제적으로 비용 절감
- 서버 장애가 발생하여도 서비스 중단없이 다른 서버로 분배하여 서비스 운용 가능
- 서비스 중단없이 서버 증설이 가능
- 세션 데이터 문제로 특정 사용자의 정보를 일관성 있게 유지할 수 없음

### 1.4 Scale-up & Scale-out
- Scale-up 
  + 서버의 사양을 높이는 경우
  + 하나의 서버가 한 번에 더 많은 응답 처리 할 수 있음

- Scale-out
  + 부하를 여러 서버에게 분산하는 경우

## 2. 기능

### 2.1 네트워크 주소 변환(NAT)
- 사설 IP 주소를 공인 IP 주소로 변경, 주소변경의 역할
- IPv4 에서 IP 주소가 부족하고 보안상에 문제가 있어서 인터넷에서 사용할 수 없는 사설 IP를 사용하는 경우가 많아지고 있음

### 2.2 동적 소스 라우팅 프로토콜(DSR)
- 서버에서 클라이언트로 되돌아가는 경우 바로 클라이언트를 찾아가는 개념
- 실제 서버와 부하 분산 서버 사이에서 가상 IP 공유하는 방식
- 부하 분산 서버와 실제 작업 서버에 모두 동일한 가상 IP를 가지도록 네트워크 구성

### 2.3 터널링(Tunneling)
- 인터넷상에서 눈에 보이지 않는 통로를 만들어 통신할 수 있게 하는 개념
- 데이터를 캡슐화해서 연결된 상호 간에만 캡슐화된 패킷을 구별해 캡슐화를 해제
- 어디든지 작업을 분산 할 수 있는 장점으로 무한한 확장성 가짐

## 3. HAProxy
- 기존의 하드웨어 스위치를 대신하는 소프트웨어 
- 네트워크 스위치에서 제공하는 L4,L7 기능 및 로드 밸런서 기능 제공
- 설치가 쉽고 빨라서 서비스 이중화를 구성하는데 사용

### 3.1 HAProxy 동작 방식
- reverse proxy 형태로 동작함
- 실제 서버 앞단에 존재하며 서버로 오는 요청 대신 받아 뒷단의 서버에 전달하고 결과 리턴받아 요청한 곳에 다시 전달하는 역할을 함
    
1. 최초 접근 시 서버에 요청 전달
2. 응답 시 쿠키에 서버 정보 추가 후 반환
3. 재요청 시 proxy에서 쿠키 정보 확인 
4. 재접근 시 쿠키 없이 추가 전달

### 3.2 HAProxy 이중화(HA) 구성
- 이중화 구성을 통하여 master HAProxy에 문제 생기는 경우 slave HAProxy에서 서비스 제공될 수 있도록 함
- 가상 IP 주소 공유하는 Active HAProxy와 Standby HAProxy가 hearbeat을 주고 받으며 정상 작동 확인
